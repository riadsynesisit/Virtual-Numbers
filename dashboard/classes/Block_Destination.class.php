<?php    class Block_Destination    {        function insertDestiantionData(){				$dest=$_REQUEST['destination'];		 $query = "insert into blocked_destinations (					destination						) values(						'$dest'						)";		$result = mysql_query($query);		if(mysql_error()==""){			return true;		}else{			return false;		}			}		function deletedestinationData($did_number){		        $query = "delete from blocked_destinations where  destination='$did_number'";		$result = mysql_query($query);				if(mysql_error()==""){						return true;					}else{			return false;		}			}				function getCountMembers()        {            $where      =   '';                      if($_REQUEST['destination']!='')            {                $dest=$_REQUEST['destination'];                $where      .=  " where b.destination like '$dest%' ";            }                                             $query  =   "select count(*) as count from blocked_destinations b $where ";                       $result =   mysql_query($query);            $row    =   mysql_fetch_array($result);            return  $row['count'];        }		function getupdate()        {            $where      =   '';                      if($_REQUEST['destiantion_number']!='')            {                $dest=$_REQUEST['destiantion_number'];				$id=$_REQUEST['destiantion_id'];                $where      .=  " where b.destination='$dest' and b.id!=$id ";            }                                             $query  =   "select count(*) as count from blocked_destinations b $where ";                       $result =   mysql_query($query);            $row    =   mysql_fetch_array($result);            return  $row['count'];        }		        function for_page_range($limit,$offset)        {            $where      =   '';                        if($_REQUEST['destination']!='')            {                $dest=$_REQUEST['destination'];                $where      .=  " where b.destination like '$dest%' ";            }                                                                          $query  =   "SELECT * FROM blocked_destinations b $where LIMIT $limit OFFSET $offset;";                                    $result =   mysql_query($query);            if(mysql_error()    ==  ""){                if(mysql_num_rows($result)  !=  0){                    while($row  =   mysql_fetch_assoc($result)){                        $ret_arr[]  =   $row;                    }                                        return $ret_arr;                }else{                    return '';                }            }else{                echo "An error occurred while getting data.<br>                Error is: ".mysql_error()."<br>";                return false;            }        }    	function getupdatenumber(){		               $id=$_POST['destiantion_id'];			   $dest=$_POST['destiantion_number'];				 $query = "update blocked_destinations set                 destination='".mysql_real_escape_string($dest)."'                where id=".$id;						$result = mysql_query($query);		if(mysql_error()    ==  ""){		return true;		}		else		{		return false;		}					}		function isDestinationBlocked($fwd_number){				//Check from the most specific to the generic number		if(substr($fwd_number,0,1)=="+"){//strip the leading + sign if any			$fwd_number = substr($fwd_number,1);		}		if(substr($fwd_number,0,2)=="00"){//strip leading 00 - international access code if any			$fwd_number = substr($fwd_number,2);			}		$num_len = strlen($fwd_number);		for($i=0;$i<$num_len;$i++){			$fwd_number = substr($fwd_number,0,$num_len - $i);//chop one digit from the right side for each iteration of the loop			$query = "select id, destination from blocked_destinations where destination='$fwd_number'";			$result = mysql_query($query);			if(mysql_error()!=""){				echo "ERROR: ".mysql_error();				exit;			}						if(mysql_num_rows($result) > 0){				return true;			}		}//end of for loop		return false;			}		function add_blocked_destination($destination){				$status = $this->isDestinationBlocked($destination);		if($status===true){			return true;//Destination already blocked.		}				$query = "insert into blocked_destinations (					destination						) values(						'$destination'						)";		$result = mysql_query($query);		if(mysql_error()==""){			return true;		}else{			return "Error: Failed add record to blocked destinations for destination $destination. ". mysql_error();		}			}	    function remove_blocked_destination($destination){				$query = "delete from blocked_destinations where destination='$destination'";		$result = mysql_query($query);		if(mysql_error()==""){			return true;		}else{			return "Error: Failed deleting a record from blocked destinations for destination $destination. ". mysql_error();		}			}		function get_blocked_destinations_count(){				$query = "select count(*) as count from blocked_destinations";		$result = mysql_query($query);		if(mysql_error()!=""){			return "Error: An error occurred while getting count of blocked destinations from blocked_destinations : ".mysql_error();		}		$row = mysql_fetch_array($result, MYSQL_ASSOC);		return $row["count"];			}		function get_blocked_destinations($limit,$offset){				$query = "select * from blocked_destinations order by datetime desc LIMIT $limit OFFSET $offset;";		$result = mysql_query($query);		if(mysql_error()!=""){			return "Error: An error occurred while getting count of black listed destinations from blocked_destinations : ".mysql_error();		}		$ret_arr = array();		while($row=mysql_fetch_assoc($result)){			$ret_arr[]=$row;		}		return $ret_arr;			}		}?>	